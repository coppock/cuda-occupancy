PATH=`dirname $0`:`dirname $0`/../../apps/cudart:$PATH
nmps=`nmps`
mkfifo $1.trace $1.occ
cut -f7-12 $1.trace | occ >$1.occ &
tail +2 $1 |
	grep -v '\[CUDA mem[^	]*]$' |
	tee $1.trace |
	cut -f2,4-6 |
	paste - $1.occ |
	awk -F'	' '{
		dur = $1
		nblocks = $2 * $3 * $4
		occ = $5 # Number of blocks per MP wave
		nmp_waves = int((nblocks - 1) / occ + 1)
		nwaves = int((nmp_waves - 1) / '$nmps') + 1
		print dur / nwaves, dur
	}'
rm $1.trace $1.occ
